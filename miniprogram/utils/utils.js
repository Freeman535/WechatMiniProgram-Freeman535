var first_menu = {
  'OY_DD':{
    pic:'../../images/OY_DD.png',
    name:'欧亚订单',
    gt: '../../pages/oy_dd/index'
  },
  'OY_JCD':{
    pic:'../../images/OY_JCD.png',
    name:'欧亚进仓单',
    gt: '../../pages/oy_jcd/index'
  },
  'OY_FCD':{
    pic:'../../images/OY_FCD.png',
    name:'欧亚返厂单',
    gt: '../../pages/oy_fcd/index'
  },
  'OY_BJD':{
    pic:'../../images/OY_BJD.png',
    name:'欧亚变价单',
    gt: '../../pages/oy_bjd/index'
  },
  'OY_SALE':{
    pic:'../../images/OY_SALE.png',
    name:'欧亚销售',
    gt: '../../pages/oy_sale/index'
  },
  'OY_FML':{
    pic:'../../images/OY_FLM.png',
    name:'欧亚负毛利',
    gt: '../../pages/oy_fml/index'
  },
  'OY_KC':{
    pic:'../../images/OY_KC.png',
    name:'欧亚库存',
    gt: '../../pages/oy_kc/index'
  },
  'QPD':{
    pic:'../../images/QPD.png',
    name:'全品单',
    gt: '../../pages/qpd/index'
  },

  'InspectionReport':{
    pic:'../../images/QPD.png',
    name:'质检报告',
    gt: '../../pages/inspectionreport/index'
  },
  'Public':{
    pic:'../../images/QPD.png',
    name:'特价公示',
    gt: '../../pages/publicS/index'
  },

  'ORDER':{
    pic:'../../images/MO.png',
    name:'销售单相关',
    gt: '../../pages/order/index'
  },

  'UM':{
    pic:'../../images/MO.png',
    name:'用户管理',
    gt: '../../pages/um/index'
  },

  'OY_Tools':{
    pic:'../../images/MO.png',
    name:'欧亚工具',
    gt: '../../pages/oy_tools/index'
  },

  'personal':{
    pic:'../../images/Change.png',
    name:'切换身份',
    gt: '../../pages/personal/index'
  },
  'ABOUT':{
    pic:'../../images/about.png',
    name:'关于',
    gt: '../../pages/about/index'
  },

}
var order_menu = {
  'CO':{
    pic:'../../images/CO.png',
    name:'修改库存及进价',
    gt: '../../pages/co/index'
  },
  'UO':{
    pic:'../../images/UO.png',
    name:'上传长春库存',
    gt: '../../pages/uo/index'
  },
  'MO':{
    pic:'../../images/MO.png',
    name:'销售单制作',
    gt: '../../pages/mo/index'
  }
}
var um_menu = {
  'Application':{
    pic:'../../images/MO.png',
    name:'用户注册审批',
    gt: '../../pages/application/index'
  },
  'URM':{
    pic:'../../images/MO.png',
    name:'用户权限修改',
    gt: '../../pages/urm/index'
  }
}
var oy_menu = {
  'OY_IfCodeInKC':{
    pic:'../../images/MO.png',
    name:'OY_IfCodeInKC',
    gt: '../../pages/oy_ifcodeinkc/index'
  },
  'OY_SaleUR':{
    pic:'../../images/MO.png',
    name:'OY_SaleUR',
    gt: '../../pages/oy_saleur/index'
  },
  'OY_DD2':{
    pic:'../../images/MO.png',
    name:'OY_DD2',
    gt: '../../pages/oy_dd2/index'
  },
  'OY_KC2':{
    pic:'../../images/MO.png',
    name:'OY_KC2',
    gt: '../../pages/oy_kc2/index'
  },
  'OY_SALE2':{
    pic:'../../images/MO.png',
    name:'OY_SALE2',
    gt: '../../pages/oy_sale2/index'
  },
  'OY_FML2':{
    pic:'../../images/MO.png',
    name:'OY_FML2',
    gt: '../../pages/oy_fml2/index'
  },
  'OY_ANA_KC':{
    pic:'../../images/MO.png',
    name:'OY_ANA_KC',
    gt: '../../pages/oy_ana_kc/index'
  },
}
var all_menu = [
  {
    'OY_DD':{
      pic:'../../images/OY_DD.png',
      name:'欧亚订单',
      gt: '../../pages/oy_dd/index'
    },
    'OY_JCD':{
      pic:'../../images/OY_JCD.png',
      name:'欧亚进仓单',
      gt: '../../pages/oy_jcd/index'
    },
    'OY_FCD':{
      pic:'../../images/OY_FCD.png',
      name:'欧亚返厂单',
      gt: '../../pages/oy_fcd/index'
    },
    'OY_BJD':{
      pic:'../../images/OY_BJD.png',
      name:'欧亚变价单',
      gt: '../../pages/oy_bjd/index'
    },
    'OY_SALE':{
      pic:'../../images/OY_SALE.png',
      name:'欧亚销售',
      gt: '../../pages/oy_sale/index'
    },
    'OY_FML':{
      pic:'../../images/OY_FLM.png',
      name:'欧亚负毛利',
      gt: '../../pages/oy_fml/index'
    },
    'OY_KC':{
      pic:'../../images/OY_KC.png',
      name:'欧亚库存',
      gt: '../../pages/oy_kc/index'
    },
    'QPD':{
      pic:'../../images/QPD.png',
      name:'全品单',
      gt: '../../pages/qpd/index'
    },
  
    'InspectionReport':{
      pic:'../../images/QPD.png',
      name:'质检报告',
      gt: '../../pages/inspectionreport/index'
    },
    'Public':{
      pic:'../../images/QPD.png',
      name:'特价公示',
      gt: '../../pages/publicS/index'
    },
    'UpOrder':{
      pic:'../../images/QPD.png',
      name:'商都系统传订单',
      gt: '../../pages/UpOrder/index'
    },
  
    'ORDER':{
      pic:'../../images/MO.png',
      name:'销售单相关',
      gt: '../../pages/order/index'
    },
  
    'UM':{
      pic:'../../images/MO.png',
      name:'用户管理',
      gt: '../../pages/um/index'
    },

    'PIM':{
      pic:'../../images/MO.png',
      name:'商品信息管理',
      gt: '../../pages/pim/pim'
    },
  
    'OY_Tools':{
      pic:'../../images/MO.png',
      name:'欧亚工具',
      gt: '../../pages/oy_tools/index'
    },
  
    'personal':{
      pic:'../../images/Change.png',
      name:'切换身份',
      gt: '../../pages/personal/index'
    },
    'ABOUT':{
      pic:'../../images/about.png',
      name:'关于',
      gt: '../../pages/about/index'
    },
  
  },
  {
    'CO':{
      pic:'../../images/CO.png',
      name:'修改库存及进价',
      gt: '../../pages/co/index'
    },
    'UO':{
      pic:'../../images/UO.png',
      name:'上传长春库存',
      gt: '../../pages/uo/index'
    },
    'MO':{
      pic:'../../images/MO.png',
      name:'销售单制作',
      gt: '../../pages/mo/index'
    }
  },
  {
    'Application':{
      pic:'../../images/MO.png',
      name:'用户注册审批',
      gt: '../../pages/application/index'
    },
    'URM':{
      pic:'../../images/MO.png',
      name:'用户权限修改',
      gt: '../../pages/urm/index'
    }
  },
  {
    'OY_IfCodeInKC':{
      pic:'../../images/MO.png',
      name:'OY_IfCodeInKC',
      gt: '../../pages/oy_ifcodeinkc/index'
    },
    'OY_SaleUR':{
      pic:'../../images/MO.png',
      name:'OY_SaleUR',
      gt: '../../pages/oy_saleur/index'
    },
    'OY_DD2':{
      pic:'../../images/MO.png',
      name:'OY_DD2',
      gt: '../../pages/oy_dd2/index'
    },
    'OY_KC2':{
      pic:'../../images/MO.png',
      name:'OY_KC2',
      gt: '../../pages/oy_kc2/index'
    },
    'OY_SALE2':{
      pic:'../../images/MO.png',
      name:'OY_SALE2',
      gt: '../../pages/oy_sale2/index'
    },
    'OY_FML2':{
      pic:'../../images/MO.png',
      name:'OY_FML2',
      gt: '../../pages/oy_fml2/index'
    },
    'OY_ANA_KC':{
      pic:'../../images/MO.png',
      name:'OY_ANA_KC',
      gt: '../../pages/oy_ana_kc/index'
    },
  },
]
const app = getApp()

function FormaDatetime(fmt, date){
  // var ndt = utils.formatDateTime('YY-mm-dd HH:MM:SS', new Date())
  let ret;
  const opt = {
    "Y+": date.getFullYear().toString(),        // 年
    "m+": (date.getMonth() + 1).toString(),     // 月
    "d+": date.getDate().toString(),            // 日
    "H+": date.getHours().toString(),           // 时
    "M+": date.getMinutes().toString(),         // 分
    "S+": date.getSeconds().toString()          // 秒
    // 有其他格式化字符需求可以继续添加，必须转化成字符串
  };
  for (let k in opt) {
    ret = new RegExp("(" + k + ")").exec(fmt);
    if (ret) {
        fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
    };
  };
  return fmt;
}

function LgbaoChackToken(token){
  return new Promise((resolve, reject)=>{
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/comm/menu/getWldwSysMenuId',
      method:"POST",
      header:{
        'Host': 'lgb.oywanhao.com',
        'Connection': 'keep-alive',
        'Content-Length': 0,
        'Accept': '*/*',
        'X-Requested-With': 'XMLHttpRequest',
        'shopCode': '',
        'token': token,
        'Origin': 'https://lgb.oywanhao.com',
        'Referer': 'https://lgb.oywanhao.com/ghsBase/process/Login/oy_index.html',
        'Accept-Encoding': 'gzip, deflate, br',
        'Accept-Language': 'zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7',
      },
      success (res) {
        if ( res['statusCode'] != 200){
          resolve(0)
        }else{
          resolve(1)
        }
      }
    })
  })
}

function LgbaoLogin(uin, pw, chache, uuid){
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/auth/account/ghsLogin',
      data:{"userName":uin,"password":pw,"captcha":chache,"ip":"","uuid":uuid},
      header:{'Content-Type':'application/json'},
      method:"POST",
      fail (res){
        resolve(res.data)
      },
      success (res){
        resolve(res.data)
      }
    })
  })
}

function checkMenu(USER_APPLICATION, menuNum){
  var menu_N = all_menu[Number(menuNum)]
  var UA = new Array()
  for (var i in menu_N){
    // console.log(app.globalData.userData['auth'].indexOf(i))
    if (app.globalData.userData['auth'].indexOf(i) != -1){
      if (USER_APPLICATION.indexOf(i) != -1){
        UA.push(menu_N[i])
      }
    }
  }
  return (UA)
}

function LgbaoGetFDH(){
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/comm/public/SearchFD?SHOPCODE=',
      method:"POST",
      header: {
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01'
      },
      success(res){
        console.log(res.data.data.data)
        app.globalData.OyFDH = res.data.data.data
      }
    })
  })
}

function LgbaoSearchDDList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/dhd/searchMain',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01'
      },
      
      data:'SHOPAndGHS=000003_000376&' +
      'FDBH=' + arrTemp[0] + '&' +
      'BMDM=&' +
      'BMJB=1&' +
      'JLBH=' + arrTemp[3] + '&' +
      'STATUS=&' +
      'HTH=-1&' +
      'ZXQK=&' +
      'SP_HH=&' +
      'RQ_S=' + arrTemp[1] + '&' +
      'RQ_E=' + arrTemp[2] + '&' +
      'SP_NAME=' + arrTemp[6] + '&' +
      'SP_CODE=' + arrTemp[5] + '&' +
      'SP_BARCODE=' + arrTemp[4] + '&' +
      'HZFS=1&' +
      'HSFS=0%2C1%2C2%2C&' +
      'SHOPCODE=000003&' +
      'GHDWDM=000376&' +
      'page=1&' +
      'rows=1000000',
      success(res){
        wx.hideLoading()
        var back = res.data.data.data.list
        resolve(back)
      }
    })
  })
}

function LgbaoSearchDDMain(ddh){
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/dhd/searchItem',
      method: "POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'token': app.globalData.OyToken
      },
      data: 'JLBH=' + ddh + '&SHOPCODE=000003&DHDH='+ ddh,
      success(res){
          var back = res.data.data.data.list
          resolve(back)



      }
    })
  })
}

function LgbaoGetOneDHD(ddh){
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/dhd/getOneDHD',
      method: "POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/json;charset=utf-8',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'token': app.globalData.OyToken
      },
      data: {"JLBH":ddh,"SHOPCODE":"000003","DHDH":ddh},
      success(res){
        console.log(String(res.data.data.data))
        console.log(res)
        if(String(res.data.data.data) == ('null')){
            wx.hideToast({
              success: (res) => {},
            })
            wx.showToast({
              title: '订单号无效',
              icon: 'error',
              duration: 2000,
              mask: true
            })
        }else{

        var back = res.data.data.data
        resolve(back)
        }

      },

    })
  })
}

function LgbaoSearcJCDList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/jhd/searchMain',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
      },
      
      data:'SHOPAndGHS=000003_000376&' +
      'FDBH=' + arrTemp[0] + '&' +
      'BMDM=&' +
      'BMJB=1&' +
      'JLBH=' + arrTemp[3] + '&' +
      'DHDH=&' +
      'STATUS=&' +
      'HTH=-1&' +
      'ZXQK=&' +
      'SP_HH=&' +
      'DJRQ_B=' + arrTemp[1] + '&' +
      'DJRQ_E=' + arrTemp[2] + '&' +
      'SP_NAME=' + arrTemp[6] + '&' +
      'SP_CODE=' + arrTemp[5] + '&' +
      'SP_BARCODE=' + arrTemp[4] + '&' +
      'HZFS=1&' +
      'doLogo=select&' +
      'HSFS=0%2C1%2C2%2C&' +
      'SHOPCODE=000003&' +
      'GHDWDM=000376&' +
      'page=1&' +
      'rows=1000000',
      success(res){
        wx.hideLoading()
        var back = (res.data.data.data.list)
        resolve(back)
      }
    })
  })
}

function LgbaoSearchJCDMain(ddh){
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/jhd/searchItem',
      method: "POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'token': app.globalData.OyToken
      },
      data: 'JLBH=' + ddh + '&SHOPCODE=000003&',
      success(res){

        var back = res.data.data.data
        resolve(back)
      }
    })
  })
}

function LgbaoSearcFCDList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/thd/searchMain',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'shopCode':''
      },
      
      data:'SHOPAndGHS=000003_000376&FDBH='+arrTemp[0]+'&BMDM=&BMJB=1&SP_HH=&JLBH='+arrTemp[3]+'&HTH=&DJRQ_B='+arrTemp[1]+'&DJRQ_E='+arrTemp[2]+'&SP_NAME='+arrTemp[6]+'&SP_CODE='+arrTemp[5]+'&SP_BARCODE='+arrTemp[4]+'&HZFS=1&SHOPCODE=000003&GHDWDM=000376&HSFS=0%2C1%2C3%2C5%2C&page=1&rows=1000000',
      success(res){
        wx.hideLoading()
        var back = (res.data.data.data.list)
        resolve(back)
      }
    })
  })
}

function LgbaoSearchFCDMain(ddh){
  wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/thd/GetOneThdItem',
      method: "POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Content-Type': 'application/json;charset=utf-8',
        'token': app.globalData.OyToken,
        'shopCode': ''
      },
      data: {"SHOPCODE":"000003","JLBH":ddh},
      success(res){
        wx.hideLoading({
          success: (res) => {},
        })
        var back = res.data.data.data
        resolve(back)
      }
    })
  })
}

function LgbaoSearcBJDList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/JJBJD/SearchMain',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'shopCode':''
      },
      
      data:'SHOPAndGHS=000003_000376&FDBH='+arrTemp[0]+'&BMDM=&BMJB=1&SP_NAME='+arrTemp[6]+'&SP_CODE='+arrTemp[5]+'&SP_BARCODE='+arrTemp[4]+'&SP_HH=&HTH=&JLBH='+arrTemp[3]+'&DJRQ_B='+arrTemp[1]+'&DJRQ_E='+arrTemp[2]+'&HZFS=1&SHOPCODE=000003&GHDWDM=000376&HSFS=0%2C1%2C3%2C5%2C4%2C&page=1&rows=10000000',
      success(res){
        wx.hideLoading()
        var back = (res.data.data.data.list)
        resolve(back)
      }
    })
  })
}

function LgbaoSearchBJDMain(ddh){
  wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/system/bh80/JJBJD/SearchItem?JLBH='+ ddh +'&SHOPCODE=000003',
      method: "POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'shopCode': ''
      },
      data:'page=1&rows=1000000',
      success(res){
        wx.hideLoading({
          success: (res) => {},
        })
        var back = res.data.data.data
        resolve(back)
      }
    })
  })
}

function LgbaoSearcSALEList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/v1/report/xs/Search',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'shopCode':''
      },
      
      data:'SHOPAndGHS=000003_000376&BMDM=&BMJB=1&FDBH='+arrTemp[0]+'&SP_SB=&HTH=%E5%85%A8%E9%83%A8&SP_NAME='+arrTemp[6]+'&SPCODE='+arrTemp[5]+'&SP_BARCODE='+arrTemp[4]+'&SP_JHDJ=&SP_HH=&SP_GG=&RQ_S='+arrTemp[1]+'&RQ_E='+arrTemp[2]+'&SPFL=&HZFS=5&HSFS=0%2C1%2C3%2C5%2C4%2C6%2C&SHOPCODE=000003&GHDWDM=000376&page=1&rows=1000000000',
      success(res){
        wx.hideLoading()
        var back = (res.data.data.data.list)
        resolve(back)
      }
    })
  })
}

function LgbaoSearcFMLList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/v1/report/xs/SearchTJXS',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'shopCode':''
      },
      
      data:'SHOPAndGHS=000003_000376&BMDM=&BMJB=1&SPFL=&SP_SB=&HTH=%E5%85%A8%E9%83%A8&RQ_S='+arrTemp[1]+'&RQ_E='+arrTemp[2]+'&SP_NAME='+arrTemp[6]+'&SPCODE='+arrTemp[5]+'&SP_BARCODE='+arrTemp[4]+'&SP_HH=&HZFS=1&HSFS=0%2C1%2C3%2C5%2C4%2C6%2C&FDLIST='+arrTemp[0]+'%2C&HZJG=5%2C&SHOPCODE=000003&GHDWDM=000376&page=1&rows=10000000',
      success(res){
        var back = (res.data.data.data.list)
        var back1 = new Array()
        for (var i in back){
          var yye = (back[i]['XSJE']) + (back[i]['YHJE']) + (back[i]['XSJE_PF']) + (back[i]['WRZXSJE'])
          if (back[i]['XSCB_HS'] - yye > 0){
            back1.push({
              'YYE': yye,
              'XSCB': back[i]['XSCB_HS'],
              'ZKJE': back[i]['ZKJE'],
              'RQ': back[i]['RQ'],
              'NAME': back[i]['NAME'],
              'HSFS': back[i]['HSFS'],
              'XSSL': back[i]['XSSL'],
              'BARCODE': back[i]['BARCODE']
            })
          }
        }
        wx.hideLoading()
        resolve(back1)
      }
    })
  })
}

function LgbaoSearcKCList(arrTemp){
  return new Promise((resolve, reject) => {
    wx.showLoading({title: '请稍等...',mask:true, icon: 'loading', duration: 10000});
    wx.request({
      url: 'https://lgb.oywanhao.com/bmcporasrv/prod/v1/report/kc/SearchMain',
      method:"POST",
      header: {
        'Host': 'lgb.oywanhao.com',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'token': app.globalData.OyToken,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'shopCode':''
      },
      
      data:'SHOPAndGHS=000003_000376&FDBH='+arrTemp[0]+'&BMJB=1&BMDM=&SP_NAME='+arrTemp[6]+'&SPCODE='+arrTemp[5]+'&SP_BARCODE='+arrTemp[4]+'&SP_HH=&SHOWKC=1&HZFS=4&RQ_KC='+arrTemp[1]+'&HSFS=0%2C1%2C3%2C5%2C4%2C&SHOPCODE=000003&GHDWDM=000376&doLogo=select&page=1&rows=1000000000',
      success(res){
        wx.hideLoading()
        var back = (res.data.data.data.list)
        resolve(back)
      }
    })
  })
}

// 通过名称判断条码为家清还是个护,0为家清，1为个护
function IfCodeLB(name){
  if(name.indexOf('动力100') != -1 ||name.indexOf('超能') != -1 ||name.indexOf('雕') != -1 ||name.indexOf('妙管家') != -1 ||name.indexOf('公道') != -1||name.indexOf('皂') != -1 ){
    return 0
  }else{
    return 1
  }
}

function backPp(name){
  if(name.indexOf('雕')){
    return '雕牌'
  }else if(name.indexOf('超能')){
    return '超能'
  }else if(name.indexOf('动力')){
    return '动力100'
  }else if(name.indexOf('妙管家')){
    return '妙管家'
  }else if(name.indexOf('公道')){
    return '公道先生'
  }else if(name.indexOf('西亚斯')){
    return '西亚斯'
  }else if(name.indexOf('西丽')){
    return '西丽'
  }else if(name.indexOf('纳爱斯')){
    return '纳爱斯'
  }else if(name.indexOf('健爽白')){
    return '健爽白'
  }else if(name.indexOf('100年')){
    return '100年润发'
  }else if(name.indexOf('伢牙乐')){
    return '伢牙乐'
  }else{
    return '纳爱斯'
  }
}

async function anaKc(fdbm){
  /**
   * 输入门店编码，输出字典  条码：备注+个数
   */
  var kc_dic = {} // kc:number
  var jhtj = {} //进货推荐
  var sale60_num = {} // 60天销售数量
  var sale30_arr = []
  var sale60_arr = []
  var back_dic = {}

  var dateTime = new Date()
  var ndt = FormaDatetime('YY-mm-dd', new Date(dateTime.setDate(dateTime.getDate()-1)))
  var ndt30 = FormaDatetime('YY-mm-dd', new Date(dateTime.setDate(dateTime.getDate()-30)))
  var ndt60 = FormaDatetime('YY-mm-dd', new Date(dateTime.setDate(dateTime.getDate()-60)))

  var kc_get = [fdbm, ndt, '', '', '', '', '', '']
  var kc_list = await LgbaoSearcKCList(kc_get)
  for (var kci in kc_list){
    if (kc_list[kci]['HSFS'] == 0){
      kc_dic[kc_list[kci]['BARCODE']] = kc_list[kci]['JCSL']
    }
  }

  var sale30_get = [fdbm, ndt30, ndt, '', '', '', '', '']
  var sale30 = await LgbaoSearcSALEList(sale30_get)
  for (var sale30i in sale30){
    if (sale30[sale30i]['HSFS'] == 0){
      sale30_arr.push(sale30[sale30i]['BARCODE'])
    }
  }
  
  var sale60_get = [fdbm, ndt60, ndt, '', '', '', '', '']
  var sale60 = await LgbaoSearcSALEList(sale60_get)
  for (var sale60i in sale60){
    if (sale60[sale60i]['HSFS'] == 0){
      sale60_num[sale60[sale60i]['BARCODE']] = sale60[sale60i]['XSSL']
      sale60_arr.push(sale60[sale60i]['BARCODE'])
    }
  }

  for( var i in kc_dic){
    
    if (sale30_arr.indexOf(i) != -1){
      back_dic[i] = String(kc_dic[i]) + ' 个。正常销售产品。'
      if (kc_dic[i]/sale60_num[i] < 1){
        jhtj[i] = '60天销售'+ String(sale60_num[i]) + ' 个，推荐进货。'
      }
    }else if(sale60_arr.indexOf(i) != -1){
      back_dic[i] = String(kc_dic[i]) + ' 个。不动销大于30天，小于60天。'
      if (kc_dic[i]/sale60_num[i] < 1){
        jhtj[i] = '60天销售'+ String(sale60_num[i]) + ' 个，推荐进货。'
      }
    }else{
      back_dic[i] = String(kc_dic[i]) + ' 个。不动销大于60天'
    }
  }

  for(var x in sale30_arr){
    if (back_dic.hasOwnProperty(sale30_arr[x]) == false){
      back_dic[sale30_arr[x]] = '无库存。但30天内有销售'
      jhtj[sale30_arr[x]] = '60天销售'+ String(sale60_num[sale30_arr[x]]) + ' 个，适当进货。'
    }
  }

  for(var y in sale60_arr){
    if (back_dic.hasOwnProperty(sale60_arr[y]) == false){
      back_dic[sale60_arr[y]] = '无库存。60天内有销售，断货30天了，'
      jhtj[sale60_arr[y]] = '60天销售'+ String(sale60_num[sale60_arr[y]]) + ' 个，适当进货。'
    }
  }
  var back_all = [back_dic, jhtj ]
  return back_all



  


}



module.exports = {
  formatDateTime: FormaDatetime,
  'out':'in',
  LgbaoChackToken: LgbaoChackToken,
  LgbaoLogin: LgbaoLogin,
  checkMenu: checkMenu,
  LgbaoGetFDH: LgbaoGetFDH,
  LgbaoSearchDDList: LgbaoSearchDDList,
  LgbaoSearchDDMain: LgbaoSearchDDMain,
  LgbaoSearcJCDList: LgbaoSearcJCDList,
  LgbaoSearchJCDMain: LgbaoSearchJCDMain,
  LgbaoSearcFCDList: LgbaoSearcFCDList,
  LgbaoSearchFCDMain: LgbaoSearchFCDMain,
  LgbaoSearcBJDList: LgbaoSearcBJDList,
  LgbaoSearchBJDMain: LgbaoSearchBJDMain,
  LgbaoSearcSALEList: LgbaoSearcSALEList,
  IfCodeLB:IfCodeLB,
  LgbaoSearcFMLList: LgbaoSearcFMLList,
  LgbaoSearcKCList: LgbaoSearcKCList,
  LgbaoGetOneDHD: LgbaoGetOneDHD,
  backPp: backPp,
  anaKc: anaKc

}